title: Weather
path: weather
icon: mdi:weather-partly-cloudy
panel: true
cards:
  - type: custom:navbar-card
    desktop:
      position: bottom
      min_width: 768
      show_labels: true
    mobile:
      position: bottom
      show_labels: true
    routes:
      - icon: mdi:home-outline
        icon_selected: mdi:home-assistant
        url: /lovelace-tablet/home
        label: Home
      - icon: mdi:sofa-outline
        icon_selected: mdi:sofa
        label: Rooms
        tap_action:
          action: open-popup
        popup:
          - icon: mdi:sofa-outline
            url: /lovelace-tablet/home#living-room
            label: Living Room
          - icon: mdi:silverware-variant
            url: /lovelace-tablet/home#kitchen
            label: Kitchen
          - icon: mdi:bed-king-outline
            url: /lovelace-tablet/home#master-suite
            label: Master Suite
          - icon: mdi:bed-outline
            url: /lovelace-tablet/home#bedrooms
            label: Bedrooms
          - icon: mdi:monitor
            url: /lovelace-tablet/home#office
            label: Office
          - icon: mdi:stairs-down
            url: /lovelace-tablet/home#basement
            label: Basement
          - icon: mdi:tools
            url: /lovelace-tablet/home#basement-utility
            label: Basement Utility
      - icon: mdi:television
        icon_selected: mdi:television-classic
        url: /lovelace-tablet/media
        label: Media
        badge:
          show: >
            [[[ return states['media_player.living_room'].state === 'playing'
            ]]]
          color: var(--green-color)
      - icon: mdi:shield-outline
        icon_selected: mdi:security
        url: /lovelace-tablet/security
        label: Security
        badge:
          show: >
            [[[ return states['binary_sensor.door_sensor_door'].state === 'on'
            || states['binary_sensor.door_sensor_door_2'].state === 'on' ]]]
          color: var(--red-color)
      - icon: mdi:weather-partly-cloudy
        url: /lovelace-tablet/weather
        label: Weather
        selected: |
          [[[
            return location.pathname.includes('/weather');
          ]]]
      - icon: mdi:dots-horizontal
        label: More
        badge:
          show: |
            [[[
              if (states['update.home_assistant_core_update'].state == "on") return true;
              else if (states['update.home_assistant_supervisor_update'].state == "on") return true;
              else if (states['sensor.ipad_battery_level'].state < 20) return true;
              else return false;
            ]]]
          color: var(--red-color)
        tap_action:
          action: open-popup
        popup:
          - icon: mdi:server-outline
            url: /lovelace-tablet/server
            label: Server
          - icon: mdi:cart
            url: /dashboard-bring/home
            label: Shopping List
          - icon: mdi:cog
            url: /config/dashboard
            label: Settings
          - icon: mdi:hammer
            url: /developer-tools/yaml
            label: Developer Tools
          - icon: mdi:printer-3d
            url: /lovelace-tablet/printers
            label: Printers
    styles: |
      .navbar {
        --navbar-primary-color: var(--purple-color);
        background: var(--contrast2);
      }
  # ============================================================
  # MAIN CONTENT - Radar Map with Weather Overlays
  # ============================================================
  - type: custom:stack-in-card
    mode: vertical
    cards:
      # Radar Map Background (full width)
      - type: iframe
        url: >-
          https://embed.windy.com/embed2.html?lat=39.0&lon=-77.0&zoom=8&level=surface&overlay=radar&product=radar&menu=&message=&marker=&calendar=now&pressure=&type=map&location=coordinates&detail=&metricWind=mph&metricTemp=%C2%B0F&radarRange=-1
        aspect_ratio: "21:9"
        card_mod:
          style: |
            :host {
              --ha-card-background: transparent;
              --ha-card-border-width: 0;
            }
            ha-card {
              background: transparent !important;
              border: none !important;
            }
    card_mod:
      style: |
        ha-card {
          background: transparent !important;
          border: none !important;
          overflow: visible !important;
          position: relative;
        }
    view_layout:
      grid-column: span 8
      grid-row: span 2
  # ============================================================
  # WEATHER OVERLAY CARD - Top Left
  # ============================================================
  - type: custom:button-card
    entity: weather.openweathermap
    show_name: false
    show_icon: false
    styles:
      card:
        - background: "rgba(0, 0, 0, 0.7)"
        - backdrop-filter: blur(10px)
        - border-radius: 16px
        - padding: 16px
        - position: absolute
        - top: 80px
        - left: 16px
        - width: 280px
        - z-index: 10
    custom_fields:
      location: |
        [[[
          return `<div style="font-size: 14px; color: #aaa; margin-bottom: 4px;">Your Location</div>`;
        ]]]
      temp: |
        [[[
          const temp = states['sensor.openweathermap_temperature']?.state || '--';
          return `<div style="font-size: 48px; font-weight: 300; color: white;">${Math.round(temp)}Â°</div>`;
        ]]]
      condition: |
        [[[
          const condition = entity.state || 'Unknown';
          return `<div style="font-size: 14px; color: #aaa; text-transform: uppercase;">${condition}</div>`;
        ]]]
      details: |
        [[[
          const humidity = states['sensor.openweathermap_humidity']?.state || '--';
          const wind = states['sensor.openweathermap_wind_speed']?.state || '--';
          const feels = states['sensor.openweathermap_feels_like_temperature']?.state || '--';
          return `
            <div style="display: flex; gap: 16px; margin-top: 12px; font-size: 12px; color: #ccc;">
              <div>
                <div style="color: #888;">Humidity</div>
                <div>${humidity}%</div>
              </div>
              <div>
                <div style="color: #888;">Wind</div>
                <div>${Math.round(wind)} mph</div>
              </div>
              <div>
                <div style="color: #888;">Feels Like</div>
                <div>${Math.round(feels)}Â°</div>
              </div>
            </div>
          `;
        ]]]
    view_layout:
      grid-column: 1 / 4
      grid-row: 1
  # ============================================================
  # TOP BAR - Quick Stats
  # ============================================================
  - type: custom:button-card
    show_name: false
    show_icon: false
    styles:
      card:
        - background: "rgba(0, 0, 0, 0.7)"
        - backdrop-filter: blur(10px)
        - border-radius: 12px
        - padding: "8px 16px"
        - position: absolute
        - top: 16px
        - right: 16px
        - z-index: 10
    custom_fields:
      stats: |
        [[[
          const sunrise = states['sensor.sun_next_rising']?.state || '06:00';
          const sunset = states['sensor.sun_next_setting']?.state || '18:00';
          const uv = states['sensor.openweathermap_uv_index']?.state || '0';
          const pressure = states['sensor.openweathermap_pressure']?.state || '--';

          // Format times
          const formatTime = (isoString) => {
            try {
              const date = new Date(isoString);
              return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true });
            } catch {
              return isoString;
            }
          };

          return `
            <div style="display: flex; gap: 24px; align-items: center; font-size: 13px; color: white;">
              <div style="text-align: center;">
                <div style="color: #f9a825;">â˜€ ${formatTime(sunrise)}</div>
              </div>
              <div style="text-align: center;">
                <div style="color: #ff7043;">â˜½ ${formatTime(sunset)}</div>
              </div>
              <div style="text-align: center;">
                <div style="color: #aaa; font-size: 10px;">UV</div>
                <div>${Math.round(uv)}</div>
              </div>
              <div style="text-align: center;">
                <div style="color: #aaa; font-size: 10px;">hPa</div>
                <div>${Math.round(pressure)}</div>
              </div>
            </div>
          `;
        ]]]
    view_layout:
      grid-column: 5 / 9
      grid-row: 1
  # ============================================================
  # FORECAST STRIP - Bottom
  # ============================================================
  - type: custom:button-card
    entity: weather.openweathermap
    show_name: false
    show_icon: false
    styles:
      card:
        - background: "rgba(0, 0, 0, 0.7)"
        - backdrop-filter: blur(10px)
        - border-radius: 12px
        - padding: 12px
        - position: absolute
        - bottom: 80px
        - left: 16px
        - right: 16px
        - z-index: 10
    custom_fields:
      forecast: |
        [[[
          const forecast = entity.attributes.forecast || [];
          const hourly = forecast.slice(0, 6);

          const getIcon = (condition) => {
            const icons = {
              'sunny': 'â˜€ï¸',
              'clear-night': 'ðŸŒ™',
              'partlycloudy': 'â›…',
              'cloudy': 'â˜ï¸',
              'rainy': 'ðŸŒ§ï¸',
              'snowy': 'â„ï¸',
              'fog': 'ðŸŒ«ï¸',
              'lightning': 'â›ˆï¸',
              'lightning-rainy': 'â›ˆï¸',
              'windy': 'ðŸ’¨',
            };
            return icons[condition] || 'ðŸŒ¤ï¸';
          };

          const formatHour = (datetime) => {
            try {
              const date = new Date(datetime);
              return date.toLocaleTimeString('en-US', { hour: 'numeric', hour12: true });
            } catch {
              return '--';
            }
          };

          let html = '<div style="display: flex; justify-content: space-around; color: white;">';

          hourly.forEach((item, i) => {
            const temp = Math.round(item.temperature);
            const icon = getIcon(item.condition);
            const time = formatHour(item.datetime);

            html += `
              <div style="text-align: center; min-width: 60px;">
                <div style="font-size: 11px; color: #aaa;">${time}</div>
                <div style="font-size: 24px; margin: 4px 0;">${icon}</div>
                <div style="font-size: 14px; font-weight: 500;">${temp}Â°</div>
              </div>
            `;
          });

          html += '</div>';
          return html;
        ]]]
    view_layout:
      grid-column: span 8
      grid-row: 2

type: custom:grid-layout
layout:
  grid-template-columns: repeat(8, 1fr)
  grid-template-rows: 1fr auto
  height: calc(100vh - 120px)
  margin: 0
  padding: 0
  position: relative
card_mod:
  style: |
    :host {
      padding: 0 !important;
      margin: 0 !important;
    }
theme: Visonos
