# ============================================================
# 3D PRINTERS PAGE
# ============================================================
# Add this as a new view in your dashboard
# Path: /lovelace-tablet/printers
# ============================================================
# OctoPrint Entity Mapping:
#   octoprint (no suffix) = MK3S (RasPi @ 10.70.10.167)
#   octoprint_2 = Ender 3 (TBD - migrating from Proxmox)
#   Prusa Mini = TBD - migrating from Proxmox
# ============================================================

title: Printers
path: printers
icon: mdi:printer-3d
panel: true
cards:
  - type: custom:navbar-card
    desktop:
      position: bottom
      min_width: 768
      show_labels: true
    mobile:
      position: bottom
      show_labels: true
    routes:
      - icon: mdi:home-outline
        icon_selected: mdi:home-assistant
        url: /lovelace-tablet/home
        label: Home
      - icon: mdi:sofa-outline
        icon_selected: mdi:sofa
        label: Rooms
        tap_action:
          action: open-popup
        popup:
          - icon: mdi:sofa-outline
            url: /lovelace-tablet/home#living-room
            label: Living Room
          - icon: mdi:silverware-variant
            url: /lovelace-tablet/home#kitchen
            label: Kitchen
          - icon: mdi:bed-king-outline
            url: /lovelace-tablet/home#master-suite
            label: Master Suite
          - icon: mdi:bed-outline
            url: /lovelace-tablet/home#bedrooms
            label: Bedrooms
          - icon: mdi:monitor
            url: /lovelace-tablet/home#office
            label: Office
          - icon: mdi:stairs-down
            url: /lovelace-tablet/home#basement
            label: Basement
          - icon: mdi:tools
            url: /lovelace-tablet/home#basement-utility
            label: Basement Utility
      - icon: mdi:music
        url: /lovelace-tablet/music
        label: Music
        badge:
          show: >
            [[[ return states['media_player.living_room'].state === 'playing'
            ]]]
          color: var(--green-color)
      - icon: mdi:shield-outline
        icon_selected: mdi:security
        url: /lovelace-tablet/security
        label: Security
        badge:
          show: >
            [[[ return states['binary_sensor.door_sensor_door'].state === 'on'
            || states['binary_sensor.door_sensor_door_2'].state === 'on' ]]]
          color: var(--red-color)
      - icon: mdi:weather-partly-cloudy
        url: /lovelace-tablet/weather
        label: Weather
      - icon: mdi:dots-horizontal
        label: More
        badge:
          show: |
            [[[
              if (states['update.home_assistant_core_update'].state == "on") return true;
              else if (states['update.home_assistant_supervisor_update'].state == "on") return true;
              else if (states['sensor.davids_iphone_battery_level'].state < 20) return true;
              else return false;
            ]]]
          color: var(--red-color)
        tap_action:
          action: open-popup
        popup:
          - icon: mdi:server-outline
            url: /lovelace-tablet/server
            label: Server
            badge:
              show: |
                [[[
                  if (states['sensor.davids_iphone_battery_level'].state < 20) return true;
                  else return false;
                ]]]
              color: var(--red-color)
          - icon: mdi:cart
            url: /dashboard-bring/home
            label: Shopping List
            badge:
              show: |
                [[[ return states['todo.shopping_list'].state > 0 ]]]
              color: var(--red-color)
              count: |
                [[[ return states['todo.shopping_list'].state ]]]
          - icon: mdi:cog
            url: /config/dashboard
            label: Settings
            badge:
              show: >
                [[[ return states['update.home_assistant_core_update'].state ===
                'on' ]]]
              color: var(--red-color)
          - icon: mdi:hammer
            url: /developer-tools/yaml
            label: Developer Tools
          - icon: mdi:printer-3d
            url: /lovelace-tablet/printers
            label: Printers
    styles: |
      .navbar {
        --navbar-primary-color: var(--purple-color);
        background: var(--contrast2);
      }
  # ============================================================
  # HEADER
  # ============================================================
  - type: custom:bubble-card
    card_type: separator
    name: 3D Printers
    icon: mdi:printer-3d
    styles: |
      .bubble-separator {
        font-size: 24px;
        font-weight: 600;
      }
    view_layout:
      grid-area: header

  # ============================================================
  # PRUSA MINI
  # ============================================================
  - type: vertical-stack
    cards:
      - type: custom:bubble-card
        card_type: separator
        name: Prusa Mini
        icon: mdi:printer-3d
        sub_button:
          - entity: switch.prusa_mini_power
            show_state: true
            show_background: false
      - type: custom:mushroom-template-card
        primary: Prusa Mini
        secondary: >-
          {{ states('sensor.octoprint_current_state') }}
        icon: mdi:printer-3d
        icon_color: >-
          {% if is_state('binary_sensor.octoprint_printing', 'on') %}
            green
          {% elif is_state('switch.prusa_mini_power', 'on') %}
            orange
          {% else %}
            grey
          {% endif %}
        badge_icon: >-
          {% if is_state('binary_sensor.octoprint_printing', 'on') %}
            mdi:printer-3d-nozzle
          {% elif is_state('switch.prusa_mini_power', 'on') %}
            mdi:power
          {% else %}
            mdi:power-off
          {% endif %}
        badge_color: >-
          {% if is_state('binary_sensor.octoprint_printing', 'on') %}
            green
          {% elif is_state('switch.prusa_mini_power', 'on') %}
            orange
          {% else %}
            red
          {% endif %}
        tap_action:
          action: more-info
          entity: sensor.octoprint_current_state
        card_mod:
          style: |
            ha-card {
              background: var(--contrast2);
            }
      # Print Progress (shown when printing)
      - type: conditional
        conditions:
          - entity: binary_sensor.octoprint_printing
            state: "on"
        card:
          type: custom:mushroom-template-card
          primary: >-
            {{ states('sensor.octoprint_current_file') }}
          secondary: >-
            {{ states('sensor.octoprint_job_percentage') }}% complete
          icon: mdi:file-document
          icon_color: green
          card_mod:
            style: |
              ha-card {
                background: var(--contrast2);
              }
      - type: conditional
        conditions:
          - entity: binary_sensor.octoprint_printing
            state: "on"
        card:
          type: gauge
          entity: sensor.octoprint_job_percentage
          name: Progress
          min: 0
          max: 100
          severity:
            green: 66
            yellow: 33
            red: 0
          card_mod:
            style: |
              ha-card {
                background: var(--contrast2);
              }
      # Camera
      - type: custom:mushroom-template-card
        primary: Camera
        icon: mdi:camera
        icon_color: grey
        tap_action:
          action: more-info
          entity: camera.octoprint_camera
        card_mod:
          style: |
            ha-card {
              background: var(--contrast2);
            }
      # Controls
      - type: horizontal-stack
        cards:
          - type: custom:bubble-card
            card_type: button
            entity: switch.prusa_mini_power
            name: Power
            icon: mdi:power
            button_type: switch
          - type: custom:bubble-card
            card_type: button
            entity: switch.prusa_mini_power_led
            name: LED
            icon: mdi:led-on
            button_type: switch
      # Print controls (when printing)
      - type: conditional
        conditions:
          - entity: binary_sensor.octoprint_printing
            state: "on"
        card:
          type: horizontal-stack
          cards:
            - type: custom:bubble-card
              card_type: button
              entity: button.octoprint_pause_job
              name: Pause
              icon: mdi:pause
              button_type: name
              tap_action:
                action: call-service
                service: button.press
                target:
                  entity_id: button.octoprint_pause_job
            - type: custom:bubble-card
              card_type: button
              entity: button.octoprint_stop_job
              name: Stop
              icon: mdi:stop
              button_type: name
              tap_action:
                action: call-service
                service: button.press
                target:
                  entity_id: button.octoprint_stop_job
    view_layout:
      grid-area: mini

  # ============================================================
  # PRUSA MK3S (RasPi @ 10.70.10.167)
  # ============================================================
  - type: vertical-stack
    cards:
      - type: custom:bubble-card
        card_type: separator
        name: Prusa MK3S
        icon: mdi:printer-3d
        sub_button:
          - entity: switch.mk3s
            show_state: true
            show_background: false
      - type: custom:mushroom-template-card
        primary: Prusa MK3S
        secondary: >-
          {{ states('sensor.octoprint_current_state') }}
        icon: mdi:printer-3d
        icon_color: >-
          {% if is_state('binary_sensor.octoprint_printing', 'on') %}
            green
          {% elif is_state('switch.mk3s', 'on') %}
            orange
          {% else %}
            grey
          {% endif %}
        badge_icon: >-
          {% if is_state('binary_sensor.octoprint_printing', 'on') %}
            mdi:printer-3d-nozzle
          {% elif is_state('switch.mk3s', 'on') %}
            mdi:power
          {% else %}
            mdi:power-off
          {% endif %}
        badge_color: >-
          {% if is_state('binary_sensor.octoprint_printing', 'on') %}
            green
          {% elif is_state('switch.mk3s', 'on') %}
            orange
          {% else %}
            red
          {% endif %}
        tap_action:
          action: more-info
          entity: sensor.octoprint_current_state
        card_mod:
          style: |
            ha-card {
              background: var(--contrast2);
            }
      # Print Progress (shown when printing)
      - type: conditional
        conditions:
          - entity: binary_sensor.octoprint_printing
            state: "on"
        card:
          type: custom:mushroom-template-card
          primary: >-
            {{ states('sensor.octoprint_current_file') }}
          secondary: >-
            {{ states('sensor.octoprint_job_percentage') }}% complete
          icon: mdi:file-document
          icon_color: green
          card_mod:
            style: |
              ha-card {
                background: var(--contrast2);
              }
      - type: conditional
        conditions:
          - entity: binary_sensor.octoprint_printing
            state: "on"
        card:
          type: gauge
          entity: sensor.octoprint_job_percentage
          name: Progress
          min: 0
          max: 100
          severity:
            green: 66
            yellow: 33
            red: 0
          card_mod:
            style: |
              ha-card {
                background: var(--contrast2);
              }
      # Camera
      - type: picture-entity
        entity: camera.octoprint_camera
        camera_view: auto
        show_state: false
        show_name: false
      # Controls
      - type: horizontal-stack
        cards:
          - type: custom:bubble-card
            card_type: button
            entity: switch.mk3s
            name: Power
            icon: mdi:power
            button_type: switch
      # Print controls (when printing)
      - type: conditional
        conditions:
          - entity: binary_sensor.octoprint_printing
            state: "on"
        card:
          type: horizontal-stack
          cards:
            - type: custom:bubble-card
              card_type: button
              entity: button.octoprint_pause_job
              name: Pause
              icon: mdi:pause
              button_type: name
              tap_action:
                action: call-service
                service: button.press
                target:
                  entity_id: button.octoprint_pause_job
            - type: custom:bubble-card
              card_type: button
              entity: button.octoprint_stop_job
              name: Stop
              icon: mdi:stop
              button_type: name
              tap_action:
                action: call-service
                service: button.press
                target:
                  entity_id: button.octoprint_stop_job
    view_layout:
      grid-area: mk3s

  # ============================================================
  # ENDER 3
  # ============================================================
  - type: vertical-stack
    cards:
      - type: custom:bubble-card
        card_type: separator
        name: Ender 3
        icon: mdi:printer-3d
        sub_button:
          - entity: switch.ender_3_power
            show_state: true
            show_background: false
      - type: custom:mushroom-template-card
        primary: Ender 3
        secondary: >-
          {{ states('sensor.octoprint_current_state_2') }}
        icon: mdi:printer-3d
        icon_color: >-
          {% if is_state('binary_sensor.octoprint_printing_2', 'on') %}
            green
          {% elif is_state('switch.ender_3_power', 'on') %}
            blue
          {% else %}
            grey
          {% endif %}
        badge_icon: >-
          {% if is_state('binary_sensor.octoprint_printing_2', 'on') %}
            mdi:printer-3d-nozzle
          {% elif is_state('switch.ender_3_power', 'on') %}
            mdi:power
          {% else %}
            mdi:power-off
          {% endif %}
        badge_color: >-
          {% if is_state('binary_sensor.octoprint_printing_2', 'on') %}
            green
          {% elif is_state('switch.ender_3_power', 'on') %}
            blue
          {% else %}
            red
          {% endif %}
        tap_action:
          action: more-info
          entity: sensor.octoprint_current_state_2
        card_mod:
          style: |
            ha-card {
              background: var(--contrast2);
            }
      # Print Progress (shown when printing)
      - type: conditional
        conditions:
          - entity: binary_sensor.octoprint_printing_2
            state: "on"
        card:
          type: custom:mushroom-template-card
          primary: >-
            {{ states('sensor.octoprint_current_file_2') }}
          secondary: >-
            {{ states('sensor.octoprint_job_percentage_2') }}% complete
          icon: mdi:file-document
          icon_color: green
          card_mod:
            style: |
              ha-card {
                background: var(--contrast2);
              }
      - type: conditional
        conditions:
          - entity: binary_sensor.octoprint_printing_2
            state: "on"
        card:
          type: gauge
          entity: sensor.octoprint_job_percentage_2
          name: Progress
          min: 0
          max: 100
          severity:
            green: 66
            yellow: 33
            red: 0
          card_mod:
            style: |
              ha-card {
                background: var(--contrast2);
              }
      # Camera
      - type: custom:mushroom-template-card
        primary: Camera
        icon: mdi:camera
        icon_color: grey
        tap_action:
          action: more-info
          entity: camera.octoprint_camera_2
        card_mod:
          style: |
            ha-card {
              background: var(--contrast2);
            }
      # Controls
      - type: horizontal-stack
        cards:
          - type: custom:bubble-card
            card_type: button
            entity: switch.ender_3_power
            name: Power
            icon: mdi:power
            button_type: switch
          - type: custom:bubble-card
            card_type: button
            entity: switch.ender_3_power_led
            name: LED
            icon: mdi:led-on
            button_type: switch
      # Print controls (when printing)
      - type: conditional
        conditions:
          - entity: binary_sensor.octoprint_printing_2
            state: "on"
        card:
          type: horizontal-stack
          cards:
            - type: custom:bubble-card
              card_type: button
              entity: button.octoprint_pause_job_2
              name: Pause
              icon: mdi:pause
              button_type: name
              tap_action:
                action: call-service
                service: button.press
                target:
                  entity_id: button.octoprint_pause_job_2
            - type: custom:bubble-card
              card_type: button
              entity: button.octoprint_stop_job_2
              name: Stop
              icon: mdi:stop
              button_type: name
              tap_action:
                action: call-service
                service: button.press
                target:
                  entity_id: button.octoprint_stop_job_2
    view_layout:
      grid-area: ender

type: custom:grid-layout
layout:
  grid-template-columns: 1fr 1fr 1fr
  grid-template-rows: auto
  grid-gap: 16px
  margin: 0
  padding: 0
  grid-template-areas: |
    "header header header"
    "mini mk3s ender"
card_mod:
  style: |
    :host {
      padding: 0 !important;
      margin: 0 !important;
    }
theme: Visonos
